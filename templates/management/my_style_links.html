<!--
  Copyright [2025] [OBARA (Nanjing) Electromechanical Co., Ltd]

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->


{% extends 'base.html' %}

{% load tz %}

{% block title %}我的仕样链接 - 小原焊枪选型数据库{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4 fade-in-up">
            <h1 class="display-6 fw-bold">
                <i class="bi bi-link-45deg me-2"></i>
                我的仕样链接
            </h1>
            <div>
                <a href="{% url 'clamps:create_style_link' %}" class="btn btn-success me-2">
                    <i class="bi bi-plus-circle me-2"></i>
                    创建新仕样
                </a>
                <a href="{% url 'clamps:management_dashboard' %}" class="btn btn-outline-secondary">
                    <i class="bi bi-arrow-left me-2"></i>
                    返回仪表板
                </a>
            </div>
        </div>
        
        <!-- 仕样链接列表 -->
        <div class="card fade-in-up">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="bi bi-list me-2"></i>
                    仕样链接管理
                </h5>
            </div>
            <div class="card-body">
                {% if style_links %}
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>链接备注</th>
                                    <th>唯一标识</th>
                                    <th>完整链接</th>
                                    <th>创建者</th>
                                    <th>AI禁用</th>
                                    <th>有效期</th>
                                    <th>点击次数</th>
                                    <th>状态</th>
                                    <th>创建时间</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for link in style_links %}
                                    <tr>
                                        <td>
                                            {{ link.name|default:"未命名" }}
                                        </td>
                                        <td>
                                            <code>{{ link.unique_id }}</code>
                                        </td>
                                        <td>
                                            <a href="{{ link.get_full_url }}" target="_blank" class="text-primary">
                                                {{ link.get_full_url }}
                                            </a>
                                        </td>
                                        <td>
                                            {{ link.created_by.username }}
                                        </td>
                                        <td>
                                            {% if link.ai_disabled %}
                                                <span class="badge bg-success">是</span>
                                            {% else %}
                                                <span class="badge bg-danger">否</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if link.expires_at %}
                                                {{ link.expires_at|date:"Y-m-d H:i" }}
                                            {% else %}
                                                <span class="badge bg-info">永久有效</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {{ link.click_count }}{% if link.max_clicks > 0 %}/{{ link.max_clicks }}{% endif %}
                                        </td>
                                        <td>
                                            {% if not link.is_active %}
                                                <span class="badge bg-danger">已禁用</span>
                                            {% elif link.is_expired %}
                                                <span class="badge bg-warning">已过期</span>
                                            {% elif link.max_clicks > 0 and link.click_count >= link.max_clicks %}
                                                <span class="badge bg-warning">已达最大点击次数</span>
                                            {% else %}
                                                <span class="badge bg-success">可用</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {{ link.created_at|date:"Y-m-d H:i" }}
                                        </td>
                                        <td>
                                    <!-- 操作按钮组 -->
                                    <div class="btn-group" role="group">
                                        <!-- 编辑按钮 -->
                                        <a href="{% url 'clamps:edit_style_link' link.id %}" class="btn btn-sm btn-outline-primary">
                                            <i class="bi bi-pencil"></i>
                                        </a>
                                        
                                        <!-- 删除按钮 -->
                                        <form method="post" action="{% url 'clamps:my_style_links' %}" style="display: inline;">
                                            {% csrf_token %}
                                            <input type="hidden" name="link_id" value="{{ link.id }}">
                                            <button type="submit" name="delete" class="btn btn-sm btn-outline-danger" onclick="return confirm('确定要删除此链接吗？');">
                                                <i class="bi bi-trash"></i>
                                            </button>
                                        </form>
                                    </div>
                                </td>
                            </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <div class="text-center py-4">
                        <i class="bi bi-inbox text-muted" style="font-size: 3rem;"></i>
                        <p class="text-muted mt-3">暂无仕样链接</p>
                        <a href="{% url 'clamps:create_style_link' %}" class="btn btn-success mt-2">
                            <i class="bi bi-plus-circle me-2"></i>
                            创建第一个仕样链接
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}