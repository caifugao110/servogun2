<!--
  Copyright [2025] [OBARA (Nanjing) Electromechanical Co., Ltd]

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->


{% extends 'base.html' %}

{% block title %}编辑仕样 - 小原焊枪选型数据库{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4 fade-in-up">
            <h1 class="display-6 fw-bold">
                <i class="bi bi-pencil-square me-2"></i>
                编辑仕样
            </h1>
            <div>
                <a href="{% url 'clamps:my_style_links' %}" class="btn btn-outline-secondary me-2">
                    <i class="bi bi-list me-2"></i>
                    我的仕样链接
                </a>
                <a href="{% url 'clamps:management_dashboard' %}" class="btn btn-outline-secondary">
                    <i class="bi bi-arrow-left me-2"></i>
                    返回仪表板
                </a>
            </div>
        </div>
        
        <!-- 编辑仕样表单 -->
        <div class="card fade-in-up">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="bi bi-pencil me-2"></i>
                    仕样链接配置
                </h5>
            </div>
            <div class="card-body">
                <form method="post" action="{% url 'clamps:edit_style_link' style_link.id %}">
                    {% csrf_token %}
                    
                    <div class="row g-3">
                        <!-- 基本信息 -->
                        <div class="col-md-6">
                            <label for="name" class="form-label">
                                <i class="bi bi-tag me-2"></i>
                                链接备注
                            </label>
                            <input type="text" class="form-control" id="name" name="name" value="{{ style_link.name }}" placeholder="请输入链接备注名称">
                            <div class="form-text">用于标识该链接的用途，方便后续管理</div>
                        </div>
                        
                        <div class="col-md-3">
                            <label for="expires_days" class="form-label">
                                <i class="bi bi-clock me-2"></i>
                                有效期（天）
                            </label>
                            <input type="number" class="form-control" id="expires_days" name="expires_days" min="0" max="365" value="{{ expires_days }}">
                            <div class="form-text">设置为0表示永久有效</div>
                        </div>
                        
                        <div class="col-md-3">
                            <label for="max_clicks" class="form-label">
                                <i class="bi bi-mouse me-2"></i>
                                最大点击次数
                            </label>
                            <input type="number" class="form-control" id="max_clicks" name="max_clicks" min="0" value="{{ style_link.max_clicks }}">
                            <div class="form-text">设置为0表示无限制</div>
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <h6>
                            <i class="bi bi-sliders me-2"></i>
                            搜索配置信息
                        </h6>
                        <p class="text-muted small">配置仕样搜索界面的显示选项和固定值</p>
                    </div>
                    
                    <div class="row g-3 mt-2">
                        <!-- 产品分类 -->
                        <div class="col-md-12">
                            <label class="form-label">
                                <i class="bi bi-folder2 me-2"></i>
                                产品分类（可多选，未勾选的将不会显示）
                            </label>
                            <div class="border p-3 rounded">
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" name="product_categories[]" value="X2C-C_recommended" {% if 'X2C-C_recommended' in style_link.search_config.product_categories %}checked{% endif %}>
                                    <label class="form-check-label">X2C-C(推荐)</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" name="product_categories[]" value="X2C-X_recommended" {% if 'X2C-X_recommended' in style_link.search_config.product_categories %}checked{% endif %}>
                                    <label class="form-check-label">X2C-X(推荐)</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" name="product_categories[]" value="X2C-V2-C" {% if 'X2C-V2-C' in style_link.search_config.product_categories %}checked{% endif %}>
                                    <label class="form-check-label">X2C-V2-C</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" name="product_categories[]" value="X2C-V2-X" {% if 'X2C-V2-X' in style_link.search_config.product_categories %}checked{% endif %}>
                                    <label class="form-check-label">X2C-V2-X</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" name="product_categories[]" value="X2C-V3-C" {% if 'X2C-V3-C' in style_link.search_config.product_categories %}checked{% endif %}>
                                    <label class="form-check-label">X2C-V3-C</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" name="product_categories[]" value="X2C-V3-X" {% if 'X2C-V3-X' in style_link.search_config.product_categories %}checked{% endif %}>
                                    <label class="form-check-label">X2C-V3-X</label>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 子分类类型 -->
                        <div class="col-md-12">
                            <label class="form-label">
                                <i class="bi bi-folder-symlink me-2"></i>
                                子分类类型
                            </label>
                            <div class="alert alert-info" role="alert">
                                <i class="bi bi-info-circle me-2"></i>
                                子分类类型禁止定义，将根据产品分类自动显示
                            </div>
                        </div>
                        
                        <!-- 变压器类型 -->
                        <div class="col-md-12">
                            <label class="form-label">
                                <i class="bi bi-gear me-2"></i>
                                变压器类型（可多选，必须至少选择一项，未勾选的将不会显示）
                            </label>
                            <div class="border p-3 rounded">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="transformers[]" value="ITS85" {% if 'ITS85' in style_link.search_config.transformers %}checked{% endif %}>
                                            <label class="form-check-label">ITS85</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="transformers[]" value="DB6-100R1" {% if 'DB6-100R1' in style_link.search_config.transformers %}checked{% endif %}>
                                            <label class="form-check-label">DB6-100R1</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="transformers[]" value="RT552" {% if 'RT552' in style_link.search_config.transformers %}checked{% endif %}>
                                            <label class="form-check-label">RT552</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="transformers[]" value="RT752" {% if 'RT752' in style_link.search_config.transformers %}checked{% endif %}>
                                            <label class="form-check-label">RT752</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="transformers[]" value="BOSCH" {% if 'BOSCH' in style_link.search_config.transformers %}checked{% endif %}>
                                            <label class="form-check-label">BOSCH</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="transformers[]" value="商科" {% if '商科' in style_link.search_config.transformers %}checked{% endif %}>
                                            <label class="form-check-label">商科</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="transformers[]" value="RT906" {% if 'RT906' in style_link.search_config.transformers %}checked{% endif %}>
                                            <label class="form-check-label">RT906</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="transformers[]" value="RT706" {% if 'RT706' in style_link.search_config.transformers %}checked{% endif %}>
                                            <label class="form-check-label">RT706</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="transformers[]" value="NI110" {% if 'NI110' in style_link.search_config.transformers %}checked{% endif %}>
                                            <label class="form-check-label">NI110</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="transformers[]" value="RT452" {% if 'RT452' in style_link.search_config.transformers %}checked{% endif %}>
                                            <label class="form-check-label">RT452</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="transformers[]" value="其他" {% if '其他' in style_link.search_config.transformers %}checked{% endif %}>
                                            <label class="form-check-label">其他</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- MOTOR厂家类型 -->
                        <div class="col-md-12">
                            <label class="form-label">
                                <i class="bi bi-gear-wide-connected me-2"></i>
                                MOTOR厂家类型（可多选，必须至少选择一项，未勾选的将不会显示）
                            </label>
                            <div class="border p-3 rounded">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="motor_manufacturers[]" value="FANUC" {% if 'FANUC' in style_link.search_config.motor_manufacturers %}checked{% endif %}>
                                            <label class="form-check-label">FANUC</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="motor_manufacturers[]" value="KUKA" {% if 'KUKA' in style_link.search_config.motor_manufacturers %}checked{% endif %}>
                                            <label class="form-check-label">KUKA</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="motor_manufacturers[]" value="YASKAWA" {% if 'YASKAWA' in style_link.search_config.motor_manufacturers %}checked{% endif %}>
                                            <label class="form-check-label">YASKAWA</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="motor_manufacturers[]" value="ABB" {% if 'ABB' in style_link.search_config.motor_manufacturers %}checked{% endif %}>
                                            <label class="form-check-label">ABB</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="motor_manufacturers[]" value="TOLOMATIC" {% if 'TOLOMATIC' in style_link.search_config.motor_manufacturers %}checked{% endif %}>
                                            <label class="form-check-label">TOLOMATIC</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="motor_manufacturers[]" value="多摩川" {% if '多摩川' in style_link.search_config.motor_manufacturers %}checked{% endif %}>
                                            <label class="form-check-label">多摩川</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="motor_manufacturers[]" value="PANASONIC" {% if 'PANASONIC' in style_link.search_config.motor_manufacturers %}checked{% endif %}>
                                            <label class="form-check-label">PANASONIC</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="motor_manufacturers[]" value="DIAKONT" {% if 'DIAKONT' in style_link.search_config.motor_manufacturers %}checked{% endif %}>
                                            <label class="form-check-label">DIAKONT</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="motor_manufacturers[]" value="SEW" {% if 'SEW' in style_link.search_config.motor_manufacturers %}checked{% endif %}>
                                            <label class="form-check-label">SEW</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="motor_manufacturers[]" value="SANYO" {% if 'SANYO' in style_link.search_config.motor_manufacturers %}checked{% endif %}>
                                            <label class="form-check-label">SANYO</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="motor_manufacturers[]" value="其他" {% if '其他' in style_link.search_config.motor_manufacturers %}checked{% endif %}>
                                            <label class="form-check-label">其他</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 数值型搜索条件锁定配置 -->
                        <div class="col-md-12">
                            <label class="form-label">
                                <i class="bi bi-lock me-2"></i>
                                数值型搜索条件锁定配置（定义具体数值后将在搜索页面中固定显示且不可更改）
                            </label>
                            <div class="border p-3 rounded">
                                <div class="row g-3">
                                    <div class="col-md-4">
                                        <label for="fixed_drawing_no_1" class="form-label">固定图号1(o)</label>
                                        <input type="text" class="form-control" id="fixed_drawing_no_1" name="fixed_fields[drawing_no_1]" value="{{ style_link.search_config.fixed_fields.drawing_no_1|default:'' }}" placeholder="不定义则允许用户输入">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="fixed_description" class="form-label">固定描述</label>
                                        <input type="text" class="form-control" id="fixed_description" name="fixed_fields[description]" value="{{ style_link.search_config.fixed_fields.description|default:'' }}" placeholder="不定义则允许用户输入">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="fixed_clamping_force" class="form-label">固定加压力</label>
                                        <input type="text" class="form-control" id="fixed_clamping_force" name="fixed_fields[clamping_force]" value="{{ style_link.search_config.fixed_fields.clamping_force|default:'' }}" placeholder="例如：~3500, 3500~5500, 5500~，不定义则允许用户输入">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="fixed_stroke" class="form-label">固定行程</label>
                                        <input type="text" class="form-control" id="fixed_stroke" name="fixed_fields[stroke]" value="{{ style_link.search_config.fixed_fields.stroke|default:'' }}" placeholder="例如：~90, 100~190, 210~，不定义则允许用户输入">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="fixed_throat_depth" class="form-label">固定喉深</label>
                                        <input type="text" class="form-control" id="fixed_throat_depth" name="fixed_fields[throat_depth]" value="{{ style_link.search_config.fixed_fields.throat_depth|default:'' }}" placeholder="例如：~100, 100~200, 200~，不定义则允许用户输入">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="fixed_throat_width" class="form-label">固定喉宽</label>
                                        <input type="text" class="form-control" id="fixed_throat_width" name="fixed_fields[throat_width]" value="{{ style_link.search_config.fixed_fields.throat_width|default:'' }}" placeholder="例如：~50, 50~100, 100~，不定义则允许用户输入">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 其他搜索字段显示控制 -->
                        <div class="col-md-12">
                            <label class="form-label">
                                <i class="bi bi-eye me-2"></i>
                                其他搜索字段显示控制（取消勾选的字段将不在搜索页面中显示）
                            </label>
                            <div class="border p-3 rounded">
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="enabled_fields[]" value="weight" {% if 'weight' in style_link.search_config.enabled_fields %}checked{% endif %}>
                                            <label class="form-check-label">重量</label>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="enabled_fields[]" value="electrode_arm_end" {% if 'electrode_arm_end' in style_link.search_config.enabled_fields %}checked{% endif %}>
                                            <label class="form-check-label">电极臂端部</label>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="enabled_fields[]" value="electrode_arm_type" {% if 'electrode_arm_type' in style_link.search_config.enabled_fields %}checked{% endif %}>
                                            <label class="form-check-label">电极臂</label>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="enabled_fields[]" value="transformer_placement" {% if 'transformer_placement' in style_link.search_config.enabled_fields %}checked{% endif %}>
                                            <label class="form-check-label">变压器放置方向</label>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="enabled_fields[]" value="flange_pcd" {% if 'flange_pcd' in style_link.search_config.enabled_fields %}checked{% endif %}>
                                            <label class="form-check-label">法兰P.C.D</label>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="enabled_fields[]" value="bracket_direction" {% if 'bracket_direction' in style_link.search_config.enabled_fields %}checked{% endif %}>
                                            <label class="form-check-label">托架方向</label>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="enabled_fields[]" value="bracket_angle" {% if 'bracket_angle' in style_link.search_config.enabled_fields %}checked{% endif %}>
                                            <label class="form-check-label">托架角度</label>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="enabled_fields[]" value="bracket_count" {% if 'bracket_count' in style_link.search_config.enabled_fields %}checked{% endif %}>
                                            <label class="form-check-label">托架个数</label>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="enabled_fields[]" value="gearbox_type" {% if 'gearbox_type' in style_link.search_config.enabled_fields %}checked{% endif %}>
                                            <label class="form-check-label">齿轮箱型式</label>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="enabled_fields[]" value="bracket_material" {% if 'bracket_material' in style_link.search_config.enabled_fields %}checked{% endif %}>
                                            <label class="form-check-label">托架材料</label>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="enabled_fields[]" value="gearbox_stroke" {% if 'gearbox_stroke' in style_link.search_config.enabled_fields %}checked{% endif %}>
                                            <label class="form-check-label">齿轮箱行程</label>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="enabled_fields[]" value="tool_changer" {% if 'tool_changer' in style_link.search_config.enabled_fields %}checked{% endif %}>
                                            <label class="form-check-label">换枪装置</label>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="enabled_fields[]" value="has_balance" {% if 'has_balance' in style_link.search_config.enabled_fields %}checked{% endif %}>
                                            <label class="form-check-label">有无平衡</label>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="enabled_fields[]" value="water_circuit" {% if 'water_circuit' in style_link.search_config.enabled_fields %}checked{% endif %}>
                                            <label class="form-check-label">水路</label>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="enabled_fields[]" value="grip_extension_length" {% if 'grip_extension_length' in style_link.search_config.enabled_fields %}checked{% endif %}>
                                            <label class="form-check-label">握杆伸出长度</label>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="enabled_fields[]" value="eccentricity" {% if 'eccentricity' in style_link.search_config.enabled_fields %}checked{% endif %}>
                                            <label class="form-check-label">偏心距离</label>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="enabled_fields[]" value="eccentricity_direction" {% if 'eccentricity_direction' in style_link.search_config.enabled_fields %}checked{% endif %}>
                                            <label class="form-check-label">偏心方向</label>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="enabled_fields[]" value="eccentricity_to_center" {% if 'eccentricity_to_center' in style_link.search_config.enabled_fields %}checked{% endif %}>
                                            <label class="form-check-label">偏心是否回到中心面</label>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="enabled_fields[]" value="guidance_method" {% if 'guidance_method' in style_link.search_config.enabled_fields %}checked{% endif %}>
                                            <label class="form-check-label">导向方式</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-4 text-center">
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-save me-2"></i>
                            更新仕样链接
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}