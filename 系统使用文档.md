# 小原焊钳选型数据库系统 - 完整使用文档

**版本：** 1.3.2  
**作者：** 技术开发二部&Manus AI  
**更新日期：** 2025年6月14日  
**文档类型：** 系统使用文档和部署指南

---

## 目录

1. [系统概述](#系统概述)
2. [系统架构](#系统架构)
3. [环境要求](#环境要求)
4. [安装部署](#安装部署)
5. [系统配置](#系统配置)
6. [用户使用指南](#用户使用指南)
7. [管理员手册](#管理员手册)
8. [数据维护](#数据维护)
9. [故障排除](#故障排除)
10. [系统维护](#系统维护)
11. [技术支持](#技术支持)

---

## 系统概述

小原焊钳选型数据库系统是一个专为小原（南京）机电有限公司开发的在线焊钳产品选型平台。该系统基于Django框架构建，采用现代化的Web技术栈，为用户提供高效、准确的焊钳产品查询和选型服务。

### 系统特点

本系统具有以下核心特点和优势：

**专业性强**：系统专门针对焊钳产品设计，涵盖了X2C系列的所有主要分类，包括X2C-C、X2C-V2、X2C-V3等型号的C型和X型焊钳。每个产品都包含详细的技术参数，如行程、加压力、重量、喉深、喉宽、变压器型号等关键指标，确保用户能够获得准确的技术信息。

**用户体验优良**：系统采用响应式设计，支持桌面端和移动端访问。界面设计简洁直观，参考了用户提供的认证系统模板，保持了一致的视觉风格。搜索功能支持多条件组合查询，用户可以根据不同的技术参数快速定位到符合要求的产品。

**数据安全可靠**：系统实现了完整的用户认证和权限管理机制。普通用户只能进行产品查询和文件下载，管理员用户可以进行用户管理、数据维护、日志查看等高级操作。所有用户操作都会记录详细的日志，便于审计和追踪。

**功能完整丰富**：除了基本的产品搜索功能外，系统还提供了产品详情查看、技术文档下载（DWG、STEP、BMP格式）、数据导出、操作日志管理等功能。管理员可以通过Web界面进行用户管理、数据维护等操作，无需直接操作数据库。

### 技术架构

系统采用经典的MVC架构模式，基于Python Django框架开发。前端使用Bootstrap 5框架确保响应式设计，后端使用SQLite数据库存储数据（可轻松迁移到PostgreSQL或MySQL）。系统支持多用户并发访问，具有良好的扩展性和维护性。




## 系统架构

### 整体架构设计

小原焊钳选型数据库系统采用三层架构设计，包括表现层、业务逻辑层和数据访问层。这种架构设计确保了系统的可维护性、可扩展性和安全性。

**表现层（Presentation Layer）**：负责用户界面的展示和用户交互。采用Django模板引擎结合Bootstrap 5框架，实现响应式Web界面。支持多种浏览器和设备，包括桌面电脑、平板电脑和智能手机。界面设计遵循现代Web设计原则，注重用户体验和可访问性。

**业务逻辑层（Business Logic Layer）**：包含系统的核心业务逻辑，如用户认证、产品搜索、权限控制、日志记录等功能。使用Django的视图（Views）和模型（Models）来实现业务逻辑，确保代码的模块化和可重用性。该层还负责数据验证、业务规则执行和异常处理。

**数据访问层（Data Access Layer）**：负责与数据库的交互，包括数据的增删改查操作。使用Django ORM（对象关系映射）来简化数据库操作，提高开发效率和代码质量。支持多种数据库后端，默认使用SQLite，可根据需要迁移到PostgreSQL或MySQL。

### 技术栈详解

**后端技术栈**：
- **Python 3.11**：作为主要编程语言，提供强大的功能和丰富的第三方库支持
- **Django 5.2.3**：Web框架，提供完整的MVC架构和丰富的内置功能
- **SQLite**：默认数据库，轻量级且易于部署，适合中小型应用
- **Pillow**：图像处理库，用于处理产品图片和文件上传

**前端技术栈**：
- **HTML5/CSS3**：现代Web标准，确保良好的浏览器兼容性
- **Bootstrap 5**：响应式CSS框架，提供一致的UI组件和布局
- **JavaScript (ES6+)**：客户端脚本，实现动态交互和用户体验优化
- **Bootstrap Icons**：图标库，提供丰富的矢量图标

### 数据库设计

系统数据库采用关系型设计，主要包含以下核心表：

**用户相关表**：
- `auth_user`：Django内置用户表，存储用户基本信息
- `clamps_log`：操作日志表，记录用户的所有操作行为

**产品相关表**：
- `clamps_category`：产品分类表，支持层级分类结构
- `clamps_product`：产品主表，存储所有焊钳产品的详细信息

数据库设计遵循第三范式，确保数据的一致性和完整性。所有表都包含创建时间和更新时间字段，便于数据追踪和维护。

### 安全架构

系统实现了多层次的安全防护机制：

**认证安全**：使用Django内置的认证系统，支持密码加密存储、会话管理和CSRF防护。用户密码采用PBKDF2算法加密，确保即使数据库泄露也无法直接获取明文密码。

**授权控制**：实现基于角色的访问控制（RBAC），区分普通用户和管理员权限。普通用户只能进行产品查询和文件下载，管理员可以进行系统管理操作。

**数据保护**：所有敏感操作都会记录详细日志，包括用户IP地址、操作时间、操作内容等信息。系统支持数据备份和恢复，确保数据安全。

**网络安全**：支持HTTPS部署，确保数据传输安全。实现了请求频率限制，防止恶意攻击和资源滥用。

## 环境要求

### 硬件要求

**最低配置要求**：
- **CPU**：双核处理器，主频2.0GHz以上
- **内存**：4GB RAM（推荐8GB以上）
- **存储空间**：20GB可用磁盘空间（包括系统文件、数据库和文件存储）
- **网络**：稳定的网络连接，支持HTTP/HTTPS协议

**推荐配置要求**：
- **CPU**：四核处理器，主频3.0GHz以上
- **内存**：16GB RAM或更高
- **存储空间**：100GB SSD存储空间
- **网络**：千兆网络连接，支持负载均衡

对于生产环境部署，建议使用云服务器或专用服务器，确保系统的稳定性和可用性。如果预期用户数量较多，可以考虑使用负载均衡和数据库集群来提高系统性能。

### 软件要求

**操作系统支持**：
- **Windows**：Windows 10/11, Windows Server 2019/2022
- **Linux**：Ubuntu 20.04/22.04 LTS, CentOS 8/9, RHEL 8/9
- **macOS**：macOS 11.0 (Big Sur) 或更高版本

**Python环境**：
- **Python版本**：3.11.0或更高版本（推荐使用最新稳定版）
- **包管理器**：pip 21.0或更高版本
- **虚拟环境**：推荐使用venv或conda创建独立的Python环境

**数据库支持**：
- **SQLite**：3.35.0或更高版本（默认配置）
- **PostgreSQL**：13.0或更高版本（生产环境推荐）
- **MySQL**：8.0或更高版本（可选）

**Web服务器**：
- **开发环境**：Django内置开发服务器
- **生产环境**：Nginx + Gunicorn（推荐）或Apache + mod_wsgi

### 浏览器兼容性

系统前端采用现代Web技术开发，支持以下浏览器：

**桌面浏览器**：
- **Chrome**：版本90及以上
- **Firefox**：版本88及以上
- **Safari**：版本14及以上
- **Edge**：版本90及以上（基于Chromium）

**移动浏览器**：
- **Chrome Mobile**：版本90及以上
- **Safari Mobile**：iOS 14及以上
- **Samsung Internet**：版本14及以上

系统采用渐进式增强设计，即使在较老的浏览器中也能提供基本功能，但推荐使用最新版本的浏览器以获得最佳用户体验。

### 网络要求

**带宽要求**：
- **最低带宽**：10Mbps上行/下行（支持10-20个并发用户）
- **推荐带宽**：100Mbps上行/下行（支持100个以上并发用户）

**端口要求**：
- **HTTP**：80端口（可选，建议重定向到HTTPS）
- **HTTPS**：443端口（推荐用于生产环境）
- **开发服务器**：8000端口（仅用于开发和测试）

**防火墙配置**：
确保Web服务器端口对外开放，同时限制数据库端口的外部访问。建议使用反向代理服务器来提高安全性和性能。


## 安装部署

### 开发环境部署

开发环境部署适用于系统开发、测试和演示。以下是详细的安装步骤：

**步骤1：准备Python环境**

首先确保系统已安装Python 3.11或更高版本。在命令行中执行以下命令检查Python版本：

```bash
python --version
# 或者
python3 --version
```

如果Python版本低于3.11，请从Python官网下载并安装最新版本。建议创建虚拟环境来隔离项目依赖：

```bash
# 创建虚拟环境
python -m venv welding_clamp_env

# 激活虚拟环境（Windows）
welding_clamp_env\Scripts\activate

# 激活虚拟环境（Linux/macOS）
source welding_clamp_env/bin/activate
```

**步骤2：获取项目代码**

将项目代码复制到目标目录，确保目录结构完整。项目的主要目录结构如下：

```
welding_clamp_project/
├── manage.py                    # Django管理脚本
├── welding_clamp_db/           # 项目配置目录
│   ├── __init__.py
│   ├── settings.py             # 项目设置
│   ├── urls.py                 # URL路由配置
│   └── wsgi.py                 # WSGI配置
├── clamps/                     # 主应用目录
│   ├── __init__.py
│   ├── admin.py                # 管理后台配置
│   ├── models.py               # 数据模型
│   ├── views.py                # 视图函数
│   ├── urls.py                 # 应用URL配置
│   ├── middleware.py           # 中间件
│   └── migrations/             # 数据库迁移文件
├── templates/                  # 模板文件目录
├── static/                     # 静态文件目录
├── media/                      # 媒体文件目录
└── requirements.txt            # 依赖包列表
```

**步骤3：安装依赖包**

在项目根目录下执行以下命令安装所需的Python包：

```bash
pip install django==5.2.3
pip install pillow
```

或者如果项目包含requirements.txt文件，可以直接安装：

```bash
pip install -r requirements.txt
```

**步骤4：数据库初始化**

执行数据库迁移命令来创建数据库表结构：

```bash
# 生成迁移文件
python manage.py makemigrations

# 执行迁移
python manage.py migrate

# 初始化基础数据
python manage.py init_data
```

**步骤5：创建管理员账户**

创建系统管理员账户用于系统管理：

```bash
python manage.py createsuperuser
```

按照提示输入管理员用户名、邮箱和密码。建议使用强密码以确保系统安全。

**步骤6：启动开发服务器**

执行以下命令启动Django开发服务器：

```bash
python manage.py runserver 0.0.0.0:8000
```

服务器启动后，可以通过浏览器访问 http://localhost:8000 来查看系统界面。

### 生产环境部署

生产环境部署需要考虑性能、安全性和稳定性。以下是推荐的部署方案：

**步骤1：服务器准备**

选择合适的服务器环境，推荐使用Linux系统（如Ubuntu 22.04 LTS）。确保服务器具有足够的资源和网络带宽。

**步骤2：安装系统依赖**

在Ubuntu系统上安装必要的系统包：

```bash
sudo apt update
sudo apt install python3.11 python3.11-venv python3-pip
sudo apt install nginx postgresql postgresql-contrib
sudo apt install git curl wget
```

**步骤3：配置数据库**

对于生产环境，推荐使用PostgreSQL数据库：

```bash
# 创建数据库用户
sudo -u postgres createuser --interactive welding_clamp_user

# 创建数据库
sudo -u postgres createdb welding_clamp_db -O welding_clamp_user

# 设置用户密码
sudo -u postgres psql
ALTER USER welding_clamp_user PASSWORD 'your_secure_password';
\q
```

**步骤4：配置Django设置**

修改settings.py文件以适应生产环境：

```python
# 生产环境设置
DEBUG = False
ALLOWED_HOSTS = ['your-domain.com', 'your-server-ip']

# 数据库配置
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql',
        'NAME': 'welding_clamp_db',
        'USER': 'welding_clamp_user',
        'PASSWORD': 'your_secure_password',
        'HOST': 'localhost',
        'PORT': '5432',
    }
}

# 静态文件配置
STATIC_ROOT = '/var/www/welding_clamp/static/'
MEDIA_ROOT = '/var/www/welding_clamp/media/'
```

**步骤5：配置Web服务器**

安装和配置Gunicorn作为WSGI服务器：

```bash
pip install gunicorn
```

创建Gunicorn配置文件：

```bash
# /etc/systemd/system/welding_clamp.service
[Unit]
Description=Welding Clamp Django Application
After=network.target

[Service]
User=www-data
Group=www-data
WorkingDirectory=/var/www/welding_clamp
ExecStart=/var/www/welding_clamp/venv/bin/gunicorn --workers 3 --bind unix:/var/www/welding_clamp/welding_clamp.sock welding_clamp_db.wsgi:application

[Install]
WantedBy=multi-user.target
```

配置Nginx作为反向代理：

```nginx
# /etc/nginx/sites-available/welding_clamp
server {
    listen 80;
    server_name your-domain.com;
    
    location = /favicon.ico { access_log off; log_not_found off; }
    
    location /static/ {
        root /var/www/welding_clamp;
    }
    
    location /media/ {
        root /var/www/welding_clamp;
    }
    
    location / {
        include proxy_params;
        proxy_pass http://unix:/var/www/welding_clamp/welding_clamp.sock;
    }
}
```

**步骤6：启用服务**

启用并启动相关服务：

```bash
sudo systemctl enable welding_clamp
sudo systemctl start welding_clamp
sudo systemctl enable nginx
sudo systemctl start nginx
```

### Docker部署（可选）

为了简化部署过程，系统也支持Docker容器化部署。以下是Docker部署的基本步骤：

**创建Dockerfile**：

```dockerfile
FROM python:3.11-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .

EXPOSE 8000

CMD ["python", "manage.py", "runserver", "0.0.0.0:8000"]
```

**创建docker-compose.yml**：

```yaml
version: '3.8'

services:
  web:
    build: .
    ports:
      - "8000:8000"
    volumes:
      - .:/app
    depends_on:
      - db
    environment:
      - DEBUG=False
      - DATABASE_URL=postgresql://user:password@db:5432/welding_clamp_db

  db:
    image: postgres:13
    volumes:
      - postgres_data:/var/lib/postgresql/data/
    environment:
      - POSTGRES_DB=welding_clamp_db
      - POSTGRES_USER=user
      - POSTGRES_PASSWORD=password

volumes:
  postgres_data:
```

**启动容器**：

```bash
docker-compose up -d
```

## 系统配置

### 基础配置

系统的主要配置文件位于`welding_clamp_db/settings.py`，包含以下重要配置项：

**调试模式配置**：
```python
# 开发环境设置为True，生产环境必须设置为False
DEBUG = True  # 生产环境改为False
```

**允许的主机配置**：
```python
# 生产环境必须指定具体的域名或IP地址
ALLOWED_HOSTS = ['localhost', '127.0.0.1', 'your-domain.com']
```

**数据库配置**：
系统默认使用SQLite数据库，适合开发和小规模部署。对于生产环境，建议使用PostgreSQL：

```python
# SQLite配置（默认）
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.sqlite3',
        'NAME': BASE_DIR / 'db.sqlite3',
    }
}

# PostgreSQL配置（生产环境推荐）
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql',
        'NAME': 'welding_clamp_db',
        'USER': 'your_db_user',
        'PASSWORD': 'your_db_password',
        'HOST': 'localhost',
        'PORT': '5432',
    }
}
```

**静态文件配置**：
```python
STATIC_URL = '/static/'
STATICFILES_DIRS = [BASE_DIR / 'static']
STATIC_ROOT = BASE_DIR / 'staticfiles'  # 生产环境收集静态文件的目录

MEDIA_URL = '/media/'
MEDIA_ROOT = BASE_DIR / 'media'
```

### 安全配置

**密钥配置**：
```python
# 生产环境必须使用强密钥，不要使用默认值
SECRET_KEY = 'your-secret-key-here'
```

**CSRF保护**：
```python
CSRF_COOKIE_SECURE = True  # HTTPS环境设置为True
CSRF_COOKIE_HTTPONLY = True
```

**会话安全**：
```python
SESSION_COOKIE_SECURE = True  # HTTPS环境设置为True
SESSION_COOKIE_HTTPONLY = True
SESSION_COOKIE_AGE = 3600  # 会话超时时间（秒）
```

### 日志配置

系统包含完整的日志配置，记录用户操作和系统事件：

```python
LOGGING = {
    'version': 1,
    'disable_existing_loggers': False,
    'handlers': {
        'file': {
            'level': 'INFO',
            'class': 'logging.FileHandler',
            'filename': 'welding_clamp.log',
        },
    },
    'loggers': {
        'django': {
            'handlers': ['file'],
            'level': 'INFO',
            'propagate': True,
        },
    },
}
```

### 邮件配置（可选）

如果需要邮件通知功能，可以配置SMTP设置：

```python
EMAIL_BACKEND = 'django.core.mail.backends.smtp.EmailBackend'
EMAIL_HOST = 'smtp.your-email-provider.com'
EMAIL_PORT = 587
EMAIL_USE_TLS = True
EMAIL_HOST_USER = 'your-email@example.com'
EMAIL_HOST_PASSWORD = 'your-email-password'
DEFAULT_FROM_EMAIL = 'your-email@example.com'
```

### 缓存配置（可选）

对于高并发场景，可以配置Redis缓存：

```python
CACHES = {
    'default': {
        'BACKEND': 'django.core.cache.backends.redis.RedisCache',
        'LOCATION': 'redis://127.0.0.1:6379/1',
    }
}
```


## 用户使用指南

### 系统登录

**访问系统**：
用户可以通过Web浏览器访问系统首页。系统支持桌面和移动设备访问，界面会自动适配不同屏幕尺寸。

**登录流程**：
1. 在首页点击"立即登录"按钮
2. 输入用户名和密码
3. 点击"登录"按钮完成认证

系统采用安全的会话管理机制，用户登录后会保持登录状态，直到主动退出或会话超时。如果长时间未操作，系统会自动退出以保护账户安全。

**密码安全**：
用户应使用强密码，包含大小写字母、数字和特殊字符。如果忘记密码，请联系系统管理员重置。系统不支持用户自助密码重置，这是为了确保数据安全。

### 产品搜索功能

产品搜索是系统的核心功能，支持多种搜索方式和条件组合。

**基础搜索**：
1. 登录后点击"开始选型"或"开始搜索"按钮
2. 进入SERVO GUN产品搜索页面
3. 选择产品分类（X2C-C、X2C-V2-C、X2C-V2-X、X2C-V3-C、X2C-V3-X、X2C-X）
4. 填写搜索条件（所有条件都是可选的）
5. 点击"开始搜索"查看结果

**搜索条件说明**：

| 字段名称 | 说明 | 输入方式 | 示例 |
|---------|------|---------|------|
| 产品分类 | 焊钳的主要分类 | 下拉选择 | X2C-C |
| 描述 | 产品描述信息 | 文本输入 | C型标准焊钳 |
| 图号1(o) | 产品图号 | 文本输入 | X2C-C-001 |
| 子分类类型 | 产品子分类 | 下拉选择 | 中型 |
| 行程 | 焊钳行程参数 | 数值输入 | 25.0 |
| 加压力 | 焊钳加压力 | 数值输入 | 4000.0 |
| 重量 | 焊钳重量 | 数值输入 | 15.5 |
| 喉深 | 焊钳喉深尺寸 | 数值输入 | 100.0 |
| 喉宽 | 焊钳喉宽尺寸 | 数值输入 | 50.0 |
| 变压器 | 变压器型号 | 文本输入 | RT552 |

**高级搜索**：
点击"高级搜索选项"可以展开更多搜索条件，包括电极臂端部、电极臂类型、变压器放置方向、法兰P.C.D、有无平衡、水路、托架方向、托架角度、MOTOR厂家、托架个数、齿轮箱型式、托架材料、齿轮箱行程、换枪装置等详细技术参数。

**搜索技巧**：
- 所有搜索条件都是可选的，留空表示不限制该条件
- 数字字段支持精确匹配，文本字段支持模糊搜索
- 可以组合多个条件进行精确查找
- 如果搜索结果过多，建议增加更多限制条件
- 如果搜索结果为空，建议减少限制条件或检查输入是否正确

### 搜索结果查看

**结果列表**：
搜索完成后，系统会显示匹配的产品列表。结果页面包含以下信息：
- 匹配产品的总数量
- 产品列表表格，显示关键参数
- 当前搜索条件摘要

**结果表格说明**：
搜索结果以表格形式展示，包含以下列：

| 列名 | 说明 | 特殊功能 |
|------|------|----------|
| 序号 | 结果编号 | 便于引用 |
| 描述 | 产品描述 | 高亮显示，可点击查看详情 |
| 图号1(o) | 产品图号 | 高亮显示，可点击查看详情 |
| 喉深 | 喉深参数 | 高亮显示，可点击查看详情 |
| 喉宽 | 喉宽参数 | 高亮显示，可点击查看详情 |
| 变压器 | 变压器型号 | 高亮显示，可点击查看详情 |
| 预览图 | 产品图片 | 显示BMP预览图，可点击放大 |
| 操作 | 功能按钮 | 查看详情、下载文件等 |

**重要提示**：表格中的"描述"、"图号1(o)"、"喉深"、"喉宽"和"变压器"五个字段采用特殊颜色标记，点击这些字段可以进入产品详情页面。

### 产品详情查看

**详情页面内容**：
点击搜索结果中的高亮字段或"详情"按钮，可以进入产品详情页面。详情页面包含以下信息：

**基本信息**：
- 产品分类和子分类
- 产品描述
- 产品图号

**技术参数**：
- 行程、加压力、重量等基础参数
- 喉深、喉宽、变压器等关键参数
- 电极臂相关参数
- 变压器和法兰参数
- 平衡和水路信息

**托架和齿轮箱**：
- 托架方向、角度、个数、材料
- MOTOR厂家信息
- 齿轮箱型式和行程
- 换枪装置信息

**产品图片**：
如果产品有对应的BMP图片文件，会在详情页面左侧显示。用户可以点击图片进行放大查看。

### 文件下载功能

系统支持三种类型的技术文档下载：

**DWG文件**：
- AutoCAD图纸文件
- 包含产品的详细工程图纸
- 适用于工程设计和制造

**STEP文件**：
- 三维模型文件
- 包含产品的3D几何信息
- 适用于CAD软件导入和分析

**BMP文件**：
- 产品预览图片
- 提供产品的直观视觉效果
- 适用于快速识别和展示

**下载方式**：
1. 在产品详情页面，找到"文件下载"区域
2. 点击对应的文件类型按钮
3. 如果文件可用，浏览器会自动开始下载
4. 如果文件不可用，按钮会显示为灰色并标注"文件不可用"

**文件命名规则**：
下载的文件按照以下规则命名：
- DWG文件：{图号1(o)}.dwg
- STEP文件：{图号1(o)}.step
- BMP文件：{图号1(o)}.bmp

**下载限制**：
为了保护系统资源，普通用户的下载频率受到限制。如果下载过于频繁，系统会提示用户稍后再试。

### 用户界面说明

**导航栏**：
- 左侧：系统Logo和名称
- 中间：主要功能链接（产品搜索）
- 右侧：主题切换、用户信息、退出登录

**主题切换**：
系统支持明亮和暗色两种主题模式，用户可以根据个人喜好和使用环境进行切换。主题设置会保存在浏览器中，下次访问时自动应用。

**响应式设计**：
系统采用响应式设计，在不同设备上都能提供良好的用户体验：
- 桌面电脑：完整功能和最佳视觉效果
- 平板电脑：适配触摸操作，保持主要功能
- 智能手机：简化界面，突出核心功能

**搜索历史**：
系统会记录用户的搜索历史，但不会在界面上显示。这些信息主要用于系统优化和问题排查。

## 管理员手册

### 管理员权限

管理员用户具有系统的完全控制权限，可以执行以下操作：
- 用户账户管理（创建、修改、删除、激活/禁用）
- 系统数据管理（产品信息、分类管理）
- 操作日志查看和分析
- 数据导出和备份
- 系统配置和维护

管理员权限通过Django的内置权限系统实现，确保只有授权用户才能访问管理功能。

### 管理后台访问

**登录管理后台**：
1. 使用管理员账户登录系统
2. 在首页点击"进入管理"按钮，或直接访问管理后台链接
3. 进入管理仪表板

**管理仪表板**：
管理仪表板提供系统概览信息，包括：
- 产品总数统计
- 用户总数统计
- 分类总数统计
- 最近操作记录

仪表板还提供快速访问链接，可以直接跳转到各个管理功能模块。

### 用户管理

**查看用户列表**：
1. 在管理仪表板点击"进入用户管理"
2. 查看所有用户的基本信息，包括用户名、邮箱、注册时间、最后登录时间、是否激活等

**用户操作**：
- **激活/禁用用户**：点击用户状态按钮可以激活或禁用用户账户
- **重置密码**：为用户重置密码，新密码会显示在页面上
- **删除用户**：永久删除用户账户（谨慎操作）
- **查看用户详情**：查看用户的详细信息和操作历史

**创建新用户**：
1. 在用户管理页面点击"创建新用户"按钮
2. 填写用户名、邮箱、密码等信息
3. 设置用户权限（普通用户或管理员）
4. 保存用户信息

**用户权限管理**：
系统支持两种用户类型：
- **普通用户**：只能进行产品搜索和文件下载
- **管理员用户**：具有完整的系统管理权限

### 数据管理

**产品数据管理**：
管理员可以通过Django管理后台进行产品数据的增删改查操作：

1. 访问Django管理后台（/admin/）
2. 登录管理员账户
3. 在"Clamps"应用下找到相关数据模型
4. 进行数据操作

**分类管理**：
- 查看现有产品分类
- 添加新的产品分类
- 修改分类信息
- 删除不需要的分类

**产品信息管理**：
- 添加新产品信息
- 修改现有产品参数
- 删除过时产品
- 批量导入产品数据

**文件管理**：
- 上传产品相关文件（DWG、STEP、BMP）
- 管理文件存储路径
- 清理无用文件

### 日志管理

**查看操作日志**：
1. 在管理仪表板点击"查看日志"
2. 查看所有用户的操作记录

**日志信息包含**：
- 操作时间
- 用户名
- 操作类型（登录、搜索、查看、下载等）
- 操作详情
- IP地址
- 用户代理信息

**日志分析**：
- 按时间范围筛选日志
- 按用户筛选操作记录
- 按操作类型分类查看
- 导出日志数据进行分析

**安全监控**：
通过日志分析可以发现：
- 异常登录行为
- 频繁操作模式
- 系统使用趋势
- 潜在安全威胁

### 数据导出

**导出功能**：
系统提供完整的数据导出功能，支持以下数据类型：
- 产品数据（CSV格式）
- 用户信息（CSV格式）
- 操作日志（CSV格式）
- 系统统计数据

**导出操作**：
1. 在管理仪表板点击"数据导出"
2. 选择要导出的数据类型
3. 设置导出参数（时间范围、筛选条件等）
4. 点击"导出"按钮
5. 下载生成的CSV文件

**数据备份**：
建议管理员定期导出系统数据进行备份，确保数据安全。备份频率建议：
- 产品数据：每月备份一次
- 用户数据：每周备份一次
- 操作日志：每天备份一次

### 系统维护

**定期维护任务**：
- 清理过期会话数据
- 压缩和归档日志文件
- 检查数据库性能
- 更新系统依赖包
- 监控系统资源使用

**性能监控**：
- 监控数据库查询性能
- 检查内存和CPU使用率
- 分析用户访问模式
- 优化慢查询

**安全维护**：
- 定期更新系统密钥
- 检查用户权限设置
- 监控异常访问行为
- 更新安全补丁

**故障处理**：
- 监控系统错误日志
- 及时处理用户反馈
- 制定应急响应计划
- 建立故障恢复流程


## 数据维护

### 数据结构说明

系统的数据维护主要涉及产品信息和分类数据的管理。了解数据结构对于有效维护系统至关重要。

**产品分类结构**：
系统采用两级分类结构：
- **一级分类**：X2C、X2C-V2、X2C-V3
- **二级分类**：在一级分类基础上添加后缀-C或-X

例如：X2C分类下包含X2C-C和X2C-X两个二级分类。

**产品数据字段**：
每个产品包含以下主要字段：
- 基本信息：分类、子分类类型、描述、图号
- 技术参数：行程、加压力、重量、喉深、喉宽、变压器等
- 扩展信息：电极臂、托架、齿轮箱等详细参数

### 数据导入流程

**准备数据文件**：
1. 使用Excel或CSV格式准备产品数据
2. 确保数据格式符合系统要求
3. 检查数据完整性和准确性

**数据导入步骤**：
1. 登录Django管理后台
2. 选择相应的数据模型
3. 使用批量导入功能或逐条添加
4. 验证导入结果

**数据验证**：
导入数据后应进行以下验证：
- 检查数据完整性
- 验证数字字段格式
- 确认分类关联正确
- 测试搜索功能

### 文件管理

**文件存储结构**：
系统文件按照以下结构存储：
```
media/
├── products/
│   ├── dwg/          # DWG文件
│   ├── step/         # STEP文件
│   └── bmp/          # BMP图片文件
└── uploads/          # 其他上传文件
```

**文件命名规范**：
- DWG文件：{图号1(o)}.dwg
- STEP文件：{图号1(o)}.step
- BMP文件：{图号1(o)}.bmp

**文件上传流程**：
1. 准备符合命名规范的文件
2. 通过FTP或文件管理器上传到对应目录
3. 确保文件权限设置正确
4. 在系统中测试文件下载功能

**文件维护**：
- 定期检查文件完整性
- 清理无关联的文件
- 备份重要文件
- 监控存储空间使用

### 数据库维护

**定期维护任务**：
1. **数据库备份**：
   ```bash
   # SQLite备份
   cp db.sqlite3 backup/db_$(date +%Y%m%d).sqlite3
   
   # PostgreSQL备份
   pg_dump welding_clamp_db > backup/db_$(date +%Y%m%d).sql
   ```

2. **数据库优化**：
   ```bash
   # Django数据库优化
   python manage.py dbshell
   VACUUM;  # SQLite
   ANALYZE; # 更新统计信息
   ```

3. **清理过期数据**：
   - 清理过期会话数据
   - 归档旧的日志记录
   - 删除临时文件

**数据一致性检查**：
- 检查外键约束
- 验证数据完整性
- 修复数据不一致问题

### 新增分类流程

当需要添加新的产品分类时，按照以下流程操作：

**步骤1：数据库操作**
1. 登录Django管理后台
2. 在Category模型中添加新分类
3. 设置分类名称和层级关系

**步骤2：代码更新**
如果新分类需要特殊处理，可能需要更新以下文件：
- `models.py`：更新模型定义
- `views.py`：更新搜索逻辑
- `templates/`：更新模板文件

**步骤3：数据迁移**
```bash
python manage.py makemigrations
python manage.py migrate
```

**步骤4：测试验证**
- 测试新分类的搜索功能
- 验证数据显示正确
- 检查权限设置

## 故障排除

### 常见问题及解决方案

**问题1：无法登录系统**

*症状*：用户输入正确的用户名和密码后仍无法登录

*可能原因*：
- 用户账户被禁用
- 密码已过期或被重置
- 会话配置问题
- 数据库连接问题

*解决方案*：
1. 检查用户账户状态：
   ```bash
   python manage.py shell
   from django.contrib.auth.models import User
   user = User.objects.get(username='用户名')
   print(user.is_active)  # 检查是否激活
   ```

2. 重置用户密码：
   ```bash
   python manage.py changepassword 用户名
   ```

3. 检查数据库连接：
   ```bash
   python manage.py dbshell
   ```

**问题2：搜索功能返回错误结果**

*症状*：搜索条件正确但返回不相关的产品

*可能原因*：
- 数据库索引问题
- 搜索逻辑错误
- 数据不一致

*解决方案*：
1. 重建数据库索引：
   ```bash
   python manage.py dbshell
   REINDEX;  # SQLite
   ```

2. 检查搜索逻辑：
   - 查看`views.py`中的搜索函数
   - 验证查询条件
   - 测试SQL查询

3. 验证数据一致性：
   - 检查产品分类关联
   - 验证数据格式

**问题3：文件下载失败**

*症状*：点击下载按钮后文件无法下载

*可能原因*：
- 文件不存在
- 文件权限问题
- 路径配置错误
- Web服务器配置问题

*解决方案*：
1. 检查文件是否存在：
   ```bash
   ls -la media/products/dwg/
   ls -la media/products/step/
   ls -la media/products/bmp/
   ```

2. 检查文件权限：
   ```bash
   chmod 644 media/products/*/*.dwg
   chmod 644 media/products/*/*.step
   chmod 644 media/products/*/*.bmp
   ```

3. 验证路径配置：
   - 检查`settings.py`中的MEDIA_ROOT和MEDIA_URL设置
   - 确认Web服务器配置正确

**问题4：系统响应缓慢**

*症状*：页面加载时间过长，用户操作响应慢

*可能原因*：
- 数据库查询效率低
- 服务器资源不足
- 网络连接问题
- 代码性能问题

*解决方案*：
1. 分析数据库查询：
   ```bash
   # 启用Django查询日志
   # 在settings.py中添加：
   LOGGING = {
       'version': 1,
       'handlers': {
           'console': {
               'class': 'logging.StreamHandler',
           },
       },
       'loggers': {
           'django.db.backends': {
               'handlers': ['console'],
               'level': 'DEBUG',
           },
       },
   }
   ```

2. 监控系统资源：
   ```bash
   top
   htop
   df -h
   free -m
   ```

3. 优化数据库查询：
   - 添加数据库索引
   - 优化查询语句
   - 使用缓存机制

### 日志分析

**系统日志位置**：
- Django应用日志：`welding_clamp.log`
- Web服务器日志：`/var/log/nginx/access.log`、`/var/log/nginx/error.log`
- 系统日志：`/var/log/syslog`

**日志分析工具**：
```bash
# 查看最近的错误日志
tail -f welding_clamp.log | grep ERROR

# 分析访问模式
awk '{print $1}' /var/log/nginx/access.log | sort | uniq -c | sort -nr

# 查找特定错误
grep "500" /var/log/nginx/access.log
```

**常见错误代码**：
- 404：页面不存在，检查URL配置
- 500：服务器内部错误，查看应用日志
- 403：权限不足，检查用户权限
- 502：网关错误，检查应用服务状态

### 性能优化

**数据库优化**：
1. 添加索引：
   ```python
   # 在models.py中添加索引
   class Product(models.Model):
       drawing_no_1 = models.CharField(max_length=50, db_index=True)
       category = models.ForeignKey(Category, on_delete=models.CASCADE, db_index=True)
   ```

2. 查询优化：
   ```python
   # 使用select_related减少查询次数
   products = Product.objects.select_related('category').all()
   ```

**缓存配置**：
```python
# settings.py
CACHES = {
    'default': {
        'BACKEND': 'django.core.cache.backends.locmem.LocMemCache',
        'LOCATION': 'unique-snowflake',
    }
}

# 在视图中使用缓存
from django.core.cache import cache

def search_products(request):
    cache_key = f"search_{hash(str(request.GET))}"
    results = cache.get(cache_key)
    if not results:
        results = perform_search(request.GET)
        cache.set(cache_key, results, 300)  # 缓存5分钟
    return results
```

## 系统维护

### 定期维护计划

**每日维护任务**：
1. 检查系统运行状态
2. 监控错误日志
3. 备份操作日志
4. 检查磁盘空间使用

**每周维护任务**：
1. 备份用户数据
2. 清理临时文件
3. 检查系统性能
4. 更新安全补丁

**每月维护任务**：
1. 完整数据库备份
2. 系统性能分析
3. 用户访问统计
4. 硬件状态检查

**每季度维护任务**：
1. 系统安全审计
2. 代码质量检查
3. 依赖包更新
4. 灾难恢复测试

### 备份策略

**数据备份**：
```bash
#!/bin/bash
# 自动备份脚本
DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_DIR="/backup/welding_clamp"

# 创建备份目录
mkdir -p $BACKUP_DIR

# 备份数据库
python manage.py dumpdata > $BACKUP_DIR/data_$DATE.json

# 备份媒体文件
tar -czf $BACKUP_DIR/media_$DATE.tar.gz media/

# 备份配置文件
cp welding_clamp_db/settings.py $BACKUP_DIR/settings_$DATE.py

# 清理旧备份（保留30天）
find $BACKUP_DIR -name "*.json" -mtime +30 -delete
find $BACKUP_DIR -name "*.tar.gz" -mtime +30 -delete
```

**恢复流程**：
```bash
# 恢复数据库
python manage.py loaddata backup/data_20250614_120000.json

# 恢复媒体文件
tar -xzf backup/media_20250614_120000.tar.gz

# 重启服务
sudo systemctl restart welding_clamp
sudo systemctl restart nginx
```

### 监控和告警

**系统监控指标**：
- CPU使用率
- 内存使用率
- 磁盘空间使用
- 网络流量
- 数据库连接数
- 应用响应时间

**监控脚本示例**：
```bash
#!/bin/bash
# 系统监控脚本

# 检查磁盘空间
DISK_USAGE=$(df / | awk 'NR==2 {print $5}' | sed 's/%//')
if [ $DISK_USAGE -gt 80 ]; then
    echo "警告：磁盘使用率超过80%"
fi

# 检查内存使用
MEM_USAGE=$(free | awk 'NR==2{printf "%.2f", $3*100/$2}')
if (( $(echo "$MEM_USAGE > 80" | bc -l) )); then
    echo "警告：内存使用率超过80%"
fi

# 检查应用状态
if ! curl -f http://localhost:8000/ > /dev/null 2>&1; then
    echo "错误：应用无法访问"
fi
```

### 安全维护

**安全检查清单**：
1. 定期更新系统密钥
2. 检查用户权限设置
3. 监控异常登录行为
4. 更新依赖包安全补丁
5. 检查文件权限设置
6. 审查访问日志

**安全加固措施**：
```python
# settings.py 安全配置
SECURE_BROWSER_XSS_FILTER = True
SECURE_CONTENT_TYPE_NOSNIFF = True
X_FRAME_OPTIONS = 'DENY'
SECURE_HSTS_SECONDS = 31536000
SECURE_HSTS_INCLUDE_SUBDOMAINS = True
SECURE_HSTS_PRELOAD = True
```

## 技术支持

### 联系方式

**技术支持团队**：
- **邮箱**：support@obara-nanjing.com
- **电话**：+86-25-XXXXXXXX
- **工作时间**：周一至周五 9:00-18:00

**紧急联系**：
对于系统故障等紧急情况，请通过以下方式联系：
- **紧急热线**：+86-138-XXXXXXXX
- **24小时邮箱**：emergency@obara-nanjing.com

### 支持服务内容

**技术咨询**：
- 系统使用指导
- 功能操作说明
- 最佳实践建议
- 性能优化建议

**故障处理**：
- 系统故障诊断
- 问题快速修复
- 数据恢复服务
- 紧急技术支持

**系统维护**：
- 定期系统检查
- 性能监控分析
- 安全漏洞修复
- 功能升级服务

### 常见问题FAQ

**Q1：忘记密码怎么办？**
A：请联系系统管理员重置密码。系统不支持用户自助密码重置功能。

**Q2：搜索结果为空是什么原因？**
A：可能的原因包括：搜索条件过于严格、数据库中没有匹配的产品、输入格式不正确。建议减少搜索条件或检查输入格式。

**Q3：文件下载失败怎么处理？**
A：首先检查网络连接，然后确认文件是否存在。如果问题持续，请联系技术支持。

**Q4：系统运行缓慢怎么办？**
A：可能是服务器负载过高或网络问题。建议稍后再试，如果问题持续请联系技术支持。

**Q5：如何申请新用户账户？**
A：请联系系统管理员申请账户。需要提供姓名、部门、联系方式等信息。

### 版本更新

**更新通知**：
系统更新时会通过以下方式通知用户：
- 系统内公告
- 邮件通知
- 电话通知（重要更新）

**更新内容**：
- 功能增强
- 性能优化
- 安全补丁
- 问题修复

**更新流程**：
1. 提前通知用户更新时间
2. 备份系统数据
3. 执行系统更新
4. 测试系统功能
5. 恢复正常服务

### 培训服务

**用户培训**：
- 系统基础操作培训
- 高级功能使用培训
- 最佳实践分享
- 定期培训课程

**管理员培训**：
- 系统管理培训
- 故障处理培训
- 安全管理培训
- 技术深度培训

**培训方式**：
- 现场培训
- 在线培训
- 视频教程
- 操作手册

---

## 结语

小原焊钳选型数据库系统是一个功能完整、安全可靠的专业选型平台。本文档详细介绍了系统的各个方面，包括安装部署、使用方法、管理维护等内容。

系统的成功运行需要用户、管理员和技术支持团队的共同努力。建议用户认真阅读本文档，熟悉系统功能和操作方法。管理员应定期进行系统维护，确保系统稳定运行。

如果在使用过程中遇到任何问题，请及时联系技术支持团队。我们将竭诚为您提供专业的技术服务。

**文档版本**：1.0.0  
**最后更新**：2025年6月14日  
**下次更新**：根据系统升级情况确定

---

*本文档由Manus AI编写，版权归小原（南京）机电有限公司所有。未经授权，不得复制或传播。*



## 功能更新说明

### 1. 数值范围查询功能

**功能描述：**

为了满足您对数字类型参数（如“行程”、“加压力”、“重量”、“喉深”、“喉宽”等）更灵活的查询需求，我们已在搜索页面 `search.html` 中实现了数值范围查询功能。现在，您可以在这些数字字段的输入框中，通过特定的格式来指定一个数值范围进行搜索。

**使用方法：**

您可以在相应的数字输入框中输入以下格式的查询字符串：

*   **`~50`**：表示查询小于或等于50的所有记录（即0到50之间，包括50本身）。
*   **`100~120`**：表示查询介于100到120之间的所有记录（包括100和120本身）。
*   **`1020~`**：表示查询大于或等于1020的所有记录（即1020以上，包括1020本身）。
*   **`精确数值`**：如果您只输入一个数字（例如 `80`），系统将执行精确匹配，查询值为80的记录。

**实现细节：**

此功能主要通过修改 `clamps/views.py` 中的 `search_results` 视图函数实现。我们添加了一个 `parse_range_query` 辅助函数，用于解析用户输入的范围字符串，并将其转换为Django ORM的 `__gte` (大于等于) 和 `__lte` (小于等于) 查询条件。这使得后端能够灵活地处理各种范围查询请求。

**注意事项：**

*   请确保输入的数字格式正确，避免包含非数字字符（除了 `~` 符号）。
*   如果输入的格式不符合上述规范，系统可能会忽略该范围条件，或返回不准确的结果。
*   此功能仅适用于数字类型的字段。

### 2. CSV文件导入更新数据库功能

**功能描述：**

为了方便您批量更新和导入产品数据，我们新增了CSV文件导入功能。现在，您可以通过管理后台上传符合特定格式的CSV文件，系统将自动解析文件内容，并根据“图号1(o)”字段更新或创建产品记录。

**访问入口：**

您可以通过登录管理员账户，进入“管理仪表板”，然后点击“导入数据”链接，即可访问CSV数据导入页面。

**使用方法：**

1.  **准备CSV文件：**
    *   **文件格式：** 必须是CSV文件，建议使用UTF-8编码，以避免中文乱码问题。如果您的文件是GB2312编码，系统也会尝试识别。
    *   **文件命名：** CSV文件的文件名（不包含扩展名）将被系统识别为产品所属的分类名称。例如，如果您要导入“X2C-C”分类下的产品数据，您的CSV文件应命名为 `X2C-C.csv`。
    *   **表头匹配：** CSV文件中的列名（表头）必须与系统中的产品字段名称严格匹配。例如，如果您有一个名为“描述”的字段，CSV文件中对应的列名也必须是“描述”。以下是支持导入的字段列表（与您提供的《查询页参数说明.doc》中的参数一致）：
        *   描述
        *   图号1(o)
        *   子分类类型
        *   行程
        *   加压力
        *   重量
        *   喉深
        *   喉宽
        *   变压器
        *   电极臂端部
        *   电极臂类型
        *   变压器放置方向
        *   法兰P.C.D
        *   有无平衡
        *   水路
        *   托架方向
        *   托架角度
        *   MOTOR厂家
        *   托架个数
        *   齿轮箱型式
        *   托架材料
        *   齿轮箱行程
        *   换枪装置
        *   ... (其他所有产品参数)
    *   **数据更新逻辑：** 系统会根据CSV文件中的“图号1(o)”字段来判断是更新现有记录还是创建新记录。如果数据库中已存在相同“图号1(o)”的产品，则更新该产品的其他字段；否则，将创建一条新的产品记录。

2.  **上传并导入：**
    *   在CSV数据导入页面，点击“选择CSV文件”按钮，选择您准备好的CSV文件。
    *   点击“上传并导入”按钮。系统将开始处理文件。

**实现细节：**

此功能主要通过修改 `clamps/views.py` 中的 `import_csv` 视图函数实现。该函数负责处理文件上传、编码检测、CSV解析以及数据的批量更新或创建。我们使用了 `chardet` 库来自动检测CSV文件的编码，以提高兼容性。

**注意事项：**

*   **数据备份：** 在执行任何数据导入操作之前，强烈建议您备份数据库，以防意外情况发生。
*   **错误处理：** 导入过程中如果遇到错误（例如，字段值类型不匹配、缺少关键字段等），系统会记录错误信息并显示在页面上，同时会跳过有问题的行，继续处理其他数据。
*   **分类存在性：** CSV文件名对应的分类必须在系统中已经存在。如果分类不存在，系统会提示错误并拒绝导入。您需要先在Django管理后台手动创建相应的分类。

### 3. 文件存储和下载功能

**文件放置位置：**

`dwg`、`step` 和 `bmp` 文件应该存放在您Django项目的 `media` 目录下。具体路径是：`/home/ubuntu/welding_clamp_project/media/`。

**示例文件和调试：**

为了方便您调试和测试下载功能，我们已经为您创建了一些示例文件，并更新了数据库中对应的产品记录（例如 `X2C-C-001`），使其指向这些示例文件。这样您就可以直接通过网站界面测试下载功能了。

**示例文件路径：**

*   `/home/ubuntu/welding_clamp_project/media/X2C-C-001.dwg`
*   `/home/ubuntu/welding_clamp_project/media/X2C-C-001.step`
*   `/home/ubuntu/welding_clamp_project/media/X2C-C-001.bmp`

您可以在产品详情页面点击相应的下载链接来测试这些文件。BMP文件在搜索结果页面也支持放大预览功能。

